<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.trechina.planocycle.mapper.PriorityOrderPtsBackupJanMapper">
    <insert id="insertBackupJan">
        insert into priority.priority_order_pts_backup_jan(priority_order_cd, shelf_pattern_cd, "group", jan, branch, rank_upd,
        branch_num_upd,branch_amount_upd) values
        <foreach collection="list" item="item" separator=",">
            (#{priorityOrderCd},#{shelfPatternCd},#{group}, #{item.jan}, #{branch},#{item.rank_upd},#{item.branch_num_upd},#{item.branch_amount_upd})
        </foreach>
        on conflict do nothing
    </insert>
    <delete id="deleteBackupJan">
        delete from priority.priority_order_pts_backup_jan where create_time &lt; current_date::timestamp - INTERVAL '1 day'
    </delete>
    <select id="selectBackupJan" resultType="map">
        select "group", jan, rank_upd from priority.priority_order_pts_backup_jan backupjan where priority_order_cd=#{priorityOrderCd} and branch=#{branch}
        and shelf_pattern_cd=#{shelfPatternCd} and not exists(select * from priority.priority_order_pts_pattern_name patternname where
        patternname.jan=backupjan.jan and shelf_name_cd!=#{shelfNameCd})
        order by "group", rank_upd
    </select>
</mapper>

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.trechina.planocycle.mapper.BasicPatternResultMapper">
    <select id="getAttrComposeList" resultType="java.util.Map">
        select
        <foreach collection="attrList" item="item" separator="," >
            zokusei${item}
        </foreach>
        ,json_object_agg ( val, nm ) as json
        from planocycle.work_basic_pattern_attr_compose compose
        inner join masterdb.planocycle_zokusei_mst_data zokuseidata on zokuseidata.class_cd = #{classCd}
        and zokuseidata.company_cd = #{company}
        and
            <foreach collection="attrList" open="(" close=")" separator="or" item="item">
                 val = zokusei${item}
            </foreach>
        where
         priority_order_cd = #{priorityOrderCd,jdbcType=INTEGER}
        group by
        <foreach collection="attrList" item="item" separator="," >
            zokusei${item}
        </foreach>
    </select>
    <select id="getAttrHeaderName" resultType="java.util.Map">
        select zokusei_id ,zokusei_nm
        from masterdb.planocycle_zokusei_mst
        where  zokusei_id in
        <foreach collection="attrList" item="item" separator="," open="(" close=")">
            #{item} ::integer
        </foreach>
        and company_cd = #{companyCd} and class_cd = #{classCd}
    </select>


</mapper>
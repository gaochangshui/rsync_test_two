<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.trechina.planocycle.mapper.WorkPriorityOrderJanNewMapper">
    <select id="selectJanNew" resultType="map">
        select jan_new as jan,face,sku_rank,jan_rank
        <foreach collection="attrList" item="item1" open="," separator=",">
            <if test="item1.zokuseiCol > (allCdList[allCdList.size-1])">"${item1.zokuseiCol}"</if>
            <if test="item1.zokuseiCol &lt;= (allCdList[allCdList.size-1])">
                <foreach collection="allCdList" item="item2" separator="|| '_' ||">
                    <if test="item2 &lt;= item1.zokuseiCol">
                        janinfo."${item2}"
                    </if>
                </foreach>
            </if>
            as "zokusei${item1.zokuseiId}"
        </foreach>
        <foreach collection="attrHeaderList" open="," item="item" separator=",">
            coalesce(janmst."${item.attrVal}", '0') as "${item.attr}"
        </foreach>
        from planocycle.work_priority_order_jan_new new
        inner join planocycle.work_priority_order_result_data resultdata
            on new.priority_order_cd= resultdata.priority_order_cd and new.jan_new = resultdata.jan_cd
        inner join ${proInfoTable} janinfo on  janinfo."1"=new.jan_new
        left join "9999".prod_0000_jan_info janmst on janmst."1" = new.jan_new
        where resultdata.priority_order_cd=#{priorityOrderCd} order by sku_rank,jan_rank
    </select>
</mapper>